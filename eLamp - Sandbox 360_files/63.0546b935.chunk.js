(this["webpackJsonp@elamp/main-app"]=this["webpackJsonp@elamp/main-app"]||[]).push([[63],{1510:function(e,t,n){"use strict";n.r(t);var r=n(139),a=n.n(r),s=n(17),u=n(286),o=n(53),i=n(0),c=n(15),d=n(19),l=n(14),p=n(63),f=n(56),b=n(10),m=n(121),v=n(3),O=n(743),j=n(893),h=n(1);t.default=function(){var e=Object(l.useTranslate)(),t=Object(O.a)().redirectToEntity404,n=Object(b.useAppContext)().getErrorMessage,r=Object(c.useParams)(),y=r.assessmentId,g=r.assessmentRowId,w=Object(c.useHistory)(),k=Object(l.useAlert)(),x=Object(d.useSaveAssessmentRowMutation)(),_=Object(o.a)(x,1)[0],I=Object(d.useGetAssessmentQuery)({variables:{id:y},onError:function(e){return t({entity:m.d.Assessment,error:e})}}),q=I.data,A=(I.loading,Object(j.d)()),T=Object(i.useMemo)((function(){if(null===q||void 0===q?void 0:q.assessment){var e,t,n="AssessmentFormContentAddon"===(null===(e=q.assessment.assessmentForm)||void 0===e||null===(t=e.content)||void 0===t?void 0:t.__typename)?q.assessment.assessmentForm.content.url:void 0;return{id:q.assessment.id,name:q.assessment.name,status:q.assessment.status,startDate:q.assessment.startDate,evaluatedUserId:q.assessment.evaluatedUser.id,assessmentRows:(q.assessment.assessmentRows||[]).map((function(e){return{id:e.id}})),result:q.assessment.result,assessmentFormContentUrl:n}}}),[q]),F=Object(i.useMemo)((function(){if(null===T||void 0===T?void 0:T.assessmentFormContentUrl)return{src:"".concat(T.assessmentFormContentUrl,"?assessmentId=").concat(y)}}),[T]),D=function(){(null===T||void 0===T?void 0:T.evaluatedUserId)&&w.push(v.b.USER_PROFILE_ASSESSMENT.getRoute({userId:T.evaluatedUserId,assessmentId:y}))};function E(e){return S.apply(this,arguments)}function S(){return(S=Object(u.a)(a.a.mark((function e(t){var r,s,u;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.rowId,s=t.data,!T){e.next=5;break}return u={assessmentId:T.id,content:s.content,rawResult:s.result,resultReport:s.result_report,validatedSkills:s.skillsToValidate.map((function(e){return{skill:e.id}}))},r&&(u.id=r),e.abrupt("return",_({variables:{input:u},refetchQueries:["GetAssessment"],awaitRefetchQueries:!0}).then((function(){return!0!==s.backgroundSave&&D(),{success:!0}})).catch((function(e){return k.error(n(e)),{success:!1}})));case 5:return e.abrupt("return",{success:!1});case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function U(){return(U=Object(u.a)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",E(Object(s.a)({rowId:g},t)));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return T?Object(h.jsxs)("div",{style:{display:"flex",height:"100%",flexDirection:"column"},children:[Object(h.jsx)(l.Line,{mb:2,ml:2,mt:2,children:Object(h.jsx)(l.Button,{onClick:D,appearance:"outline",children:"< ".concat(e("back"))})}),Object(h.jsxs)(l.Line,{mb:2,px:2,children:[Object(h.jsxs)(l.Line,{mr:3,children:[Object(h.jsx)(l.Icon,{as:f.a,mr:2}),Object(h.jsx)(l.Text,{fontSize:"huge",fontWeight:"bold",children:T.name})]}),Object(h.jsx)(p.AssessmentStatus,{status:T.status,startDate:T.startDate})]}),Object(h.jsx)("div",{style:{flex:"1 1 auto"},children:Object(h.jsx)(j.a,{userKey:T.evaluatedUserId,aoData:F||{},height:"auto",requestsHandlers:Object(s.a)(Object(s.a)({},A),{},{assessment:{get:function(){var e=Object(u.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null===q||void 0===q?void 0:q.assessment);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},update_assessment:function(e){return U.apply(this,arguments)}})})})]}):Object(h.jsx)(l.Loader,{})}},743:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(15),a=n(19),s=n(3),u=function(){var e=Object(r.useHistory)();return{redirectToEntity404:function(t){var n=t.entity;t.error.message===a.ErrorCodeEnum.NotFound&&e.push(s.b.PAGE_NOT_FOUND.getRoute({entity:n}))}}}},893:function(e,t,n){"use strict";n.d(t,"a",(function(){return y})),n.d(t,"b",(function(){return k})),n.d(t,"c",(function(){return F})),n.d(t,"d",(function(){return D}));var r=n(139),a=n.n(r),s=n(286),u=n(0),o=n(751),i=n(936),c=n(14),d=n(63),l=n(10),p=n(858),f=n(859),b=n(937),m=n(1011),v=n(792),O=(n(938),function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(){return Object(p.a)(this,n),t.apply(this,arguments)}return Object(f.a)(n,[{key:"generateDocument",value:function(e){var t=this.buildHeaders(),n="".concat(Object(d.getDomainUrl)(),"/resume");return fetch(n+"/api/templates/generate",this.buildFetchOptions({method:"POST",headers:t,body:Object(o.get)(e,"docData",{})})).then((function(e){return e.blob()})).then((function(t){Object(v.saveAs)(t,Object(o.get)(e,"filename","generated_document."+Object(o.get)(e,"docData.format","pdf")))}))}}]),n}(function(){function e(){Object(p.a)(this,e),this.API_URL=document.getElementById("url-root").getAttribute("data")+"/api/",this.API_URL_V2=document.getElementById("url-root").getAttribute("data")+"/api/v2/",this.ROOT_URL=document.getElementById("url-server").getAttribute("data")+"/api/"}return Object(f.a)(e,[{key:"buildHeaders",value:function(e){var t={"Content-Type":"application/json"};return(e=e||{})["Content-Type"]&&(t["Content-Type"]=e["Content-Type"]),t}},{key:"buildFetchOptions",value:function(e){var t;return t=e.body&&!1!==e.parseBody?JSON.stringify(e.body):e.body,{method:e.method||"GET",headers:e.headers||{},body:t||void 0,credentials:"same-origin"}}},{key:"checkResponseStatus",value:function(e){if(e.status>=200&&e.status<310)return e;var t;switch(e.status){case 401:"localhost"!==window.location.hostname?window.location="".concat(window.location.origin,"/login?next=").concat(window.location):console.log("atk expired, needs to be updated"),t=new d.NotAuthedError(e.statusText);break;case 403:t=new d.PermissionDeniedError(e.statusText);break;case 404:t=new d.ResourceNotFoundError(e.statusText);break;case 500:default:t=new d.UnknownError(e.statusText)}throw t.response=e,t}},{key:"defaultErrorHandler",value:function(e,t,n){n.error(t(e.label))}},{key:"parseJSON",value:function(e){return e.json()}},{key:"addAntiCacheTimestamp",value:function(e){return e?e+(-1!==e.indexOf("?")?"&":"?")+"_="+Date.now():e}}],[{key:"objects",value:function(){if("BaseModel"===this.class)throw new Error("cannot instantiate BaseModel");return new this}}]),e}())),j=n(1),h=new O,y=function(e){var t=e.aoData,n=e.requestsHandlers,r=e.userKey,p=Object(u.useRef)(null),f=Object(l.useAppContext)().user;Object(u.useEffect)((function(){return window.addEventListener("message",b),function(){return window.removeEventListener("message",b)}}),[]);var b=function(){var e=Object(s.a)(a.a.mark((function e(t){var r,s,u,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.data.action,e.next="get_context_request"===e.t0?3:"get_infos_request"===e.t0?5:"generate_document"===e.t0?24:"update_assessment"===e.t0?27:29;break;case 3:return(null===(r=p.current)||void 0===r?void 0:r.contentWindow)&&p.current.contentWindow.postMessage({action:"get_context",reqId:t.data.reqId,body:m()},"*"),e.abrupt("break",30);case 5:e.t1=t.data.data_type,e.next="user_infos"===e.t1?8:"user_jobs"===e.t1?10:"app_qualifiers"===e.t1?12:"skills"===e.t1?14:"assessment"===e.t1?16:"skill_validations"===e.t1?18:"user_powers"===e.t1?20:22;break;case 8:return s=n.user_infos.get,e.abrupt("break",22);case 10:return s=n.user_jobs.get,e.abrupt("break",22);case 12:return s=n.app_qualifiers.get,e.abrupt("break",22);case 14:return s=n.skills.get,e.abrupt("break",22);case 16:return s=n.assessment.get,e.abrupt("break",22);case 18:return s=n.skill_validations.get,e.abrupt("break",22);case 20:return s=n.user_powers.get,e.abrupt("break",22);case 22:return s&&s(t.data||{}).then((function(e){var n;(null===(n=p.current)||void 0===n?void 0:n.contentWindow)&&p.current.contentWindow.postMessage({action:"get_infos",reqId:t.data.reqId,body:e},"*")}),(function(e){var n;(null===(n=p.current)||void 0===n?void 0:n.contentWindow)&&p.current.contentWindow.postMessage({action:"get_infos",reqId:t.data.reqId,error:"error"},"*")})),e.abrupt("break",30);case 24:return(u=Object(o.get)(t.data,"data"))?h.generateDocument(u).then((function(){var e;(null===(e=p.current)||void 0===e?void 0:e.contentWindow)&&p.current.contentWindow.postMessage({action:"generate_document_done",reqId:Object(o.get)(t.data,"reqId"),body:{success:!0}},"*")})).catch((function(e){var t;(null===(t=p.current)||void 0===t?void 0:t.contentWindow)&&p.current.contentWindow.postMessage({action:"generate_document_done",reqId:Object(o.get)(e.data,"reqId"),body:{success:!1}},"*")})):(null===(i=p.current)||void 0===i?void 0:i.contentWindow)&&p.current.contentWindow.postMessage({action:"generate_document_done",reqId:Object(o.get)(t.data,"reqId"),body:{success:!1}},"*"),e.abrupt("break",30);case 27:return n.update_assessment(t.data).then((function(e){var n,r=e.success;(null===(n=p.current)||void 0===n?void 0:n.contentWindow)&&p.current.contentWindow.postMessage({action:"update_assessment",reqId:t.data.reqId,body:{success:r}},"*")})),e.abrupt("break",30);case 29:return e.abrupt("break",30);case 30:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),m=function(){return{active_user:f.id||null,user:r,client:Object(d.getAppConfiguration)(),addOnData:t}},v=Object(j.jsx)("iframe",{ref:p,src:t.src,height:"100%",width:"100%",style:{borderWidth:0},title:"assessmentIframe"}),O=i.isMobileSafari?" webkit-scroll":"",y=Object(j.jsx)(c.Box,{width:"100%",height:"100%",className:O,children:v});return Object(j.jsx)(c.Box,{width:"100%",height:"100%",className:"fullh fullw",children:y})},g=n(285),w=["aoData","userKey","requestsHandlers","isOpened","onClose"],k=function(e){var t=e.aoData,n=e.userKey,r=e.requestsHandlers,a=e.isOpened,s=e.onClose;Object(g.a)(e,w);return Object(j.jsx)(l.StandardModal,{isOpened:a,onClose:s,width:"90vw",height:"90vw",children:"undefined"!==typeof t&&Object(j.jsx)(y,{aoData:t,requestsHandlers:r,userKey:n})})},x=n(187),_=n(53),I=n(17),q=n(115),A=n(19),T=["__typename"],F=function(e){var t=e.userLocale,n=Object(u.useState)(),r=Object(_.a)(n,2),a=r[0],s=r[1],o=Object(c.useSwitch)(!1),i=o.active,d=o.on,l=o.off,p=function(e){var t=e.userLocale,n=Object(A.useGetAddonsQuery)(),r=n.data,a=n.loading;return{addons:Object(u.useMemo)((function(){var e=null===r||void 0===r?void 0:r.me.organization.addons;if(e)return e.filter((function(e){return"resource-button"===e.capability})).map((function(e){e.__typename;var n=Object(g.a)(e,T);return Object(I.a)(Object(I.a)({},n),{},{title:n.title[t||""]||n.title.default})}))}),[r]),isLoading:a}}({userLocale:t}),f=p.addons,b=p.isLoading,m=D();Object(u.useEffect)((function(){i||s(void 0)}),[i]),Object(u.useEffect)((function(){"undefined"!==typeof a&&d()}),[a]);return{addons:f,isLoading:b,isOpened:i,close:l,selectAddon:function(e){if("undefined"!==typeof f){var t=f.find((function(t){return t.id===e}));"undefined"!==typeof t&&s(t)}},addonData:a,requestsHandlers:m}},D=function(){var e=Object(q.a)(),t=function(){var t=Object(s.a)(a.a.mark((function t(n){return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.query({query:A.AssessmentAddonGetUserInfosDocument,variables:{userId:n}}).then((function(e){var t,n,r,a,s,u,o=null===(t=e.data)||void 0===t?void 0:t.user;if(o)return Object(I.a)(Object(I.a)({},Object(A.getFormatedUserBasicFragment)(o)),{},{email:Object(A.maybeToOptional)(o.email),title:Object(A.maybeToOptional)(o.email),place:{label:(null===(n=o.place)||void 0===n?void 0:n.label)||"",location:{longitude:(null===(r=o.place)||void 0===r||null===(a=r.location)||void 0===a?void 0:a.longitude)||0,latitude:(null===(s=o.place)||void 0===s||null===(u=s.location)||void 0===u?void 0:u.latitude)||0}},externalId:Object(A.maybeToOptional)(o.externalId),birthday:Object(A.maybeToOptional)(o.birthday),startDate:Object(A.maybeToOptional)(o.startDate),endDate:Object(A.maybeToOptional)(o.endDate),headline:Object(A.maybeToOptional)(o.headline),customFields:Object(A.maybeToOptional)(o.customFields),locale:Object(A.maybeToOptional)(null===o||void 0===o?void 0:o.locale),groups:null===o||void 0===o?void 0:o.groups.nodes.map((function(e){return{id:e.id,name:e.name}}))})})));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),n=function(){var t=Object(s.a)(a.a.mark((function t(n){return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.query({query:A.AssessmentAddonGetUserPowersDocument,variables:{userId:n}}).then((function(e){var t,n,r=null===(t=e.data)||void 0===t||null===(n=t.user)||void 0===n?void 0:n.poweredSkills.edges;if("undefined"!==typeof r)return r.map((function(e){var t=e.qualifiers.edges.reduce((function(e,t){return Object(I.a)(Object(I.a)({},e),{},Object(x.a)({},t.node.id,{value:t.value,validated:t.validated,updated:t.updatedAt}))}),{});return{id:e.id,description:Object(A.maybeToOptional)(e.description),skill:Object(I.a)(Object(I.a)({},Object(A.getFormatedSkillBasicFragment)(e.skill)),{},{externalId:e.skill.externalId||"",customFields:Object(A.maybeToOptional)(e.skill.customFields),libraryContext:Object(A.getFormatedLibraryBasicFragment)(e.skill.libraryContext)}),qualifiers:e.skill.qualifiers.nodes.map((function(e){var n=t[e.id];return Object(I.a)(Object(I.a)({},Object(A.getFormatedQualifierBasicFragment)(e)),n||{})}))}}))})));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),r=function(){var t=Object(s.a)(a.a.mark((function t(n){var r,s;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.userId,s=n.skillId,t.abrupt("return",e.query({query:A.AssessmentAddonGetSkillReviewsDocument,variables:{userId:r,skillId:s}}).then((function(e){var t,n,r;return((null===(t=e.data)||void 0===t||null===(n=t.user)||void 0===n||null===(r=n.power)||void 0===r?void 0:r.skillReviews.nodes)||[]).map((function(e){var t={id:e.assessor.id,displayName:e.assessor.displayName,avatarURL:Object(A.maybeToOptional)(e.assessor.avatarURL)};return"User"===e.assessor.__typename&&(t.familyName=Object(A.maybeToOptional)(e.assessor.familyName),t.givenName=Object(A.maybeToOptional)(e.assessor.givenName)),{id:e.id,actionType:e.actionType,assessor:Object(A.getFormatedUserBasicFragment)(t),comment:Object(A.maybeToOptional)(e.comment),created:e.createdAt,qualifiers:e.qualifiers.edges.map((function(e){return{id:e.node.id,value:e.value,validated:e.validated}}))}}))})));case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),u=function(){var t=Object(s.a)(a.a.mark((function t(n){return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.query({query:A.AssessmentAddonGetUserPinnedJobsDocument,variables:{id:n}}).then((function(e){var t,n,r=null===(t=e.data)||void 0===t||null===(n=t.user)||void 0===n?void 0:n.pinnedJobs.nodes;if(r)return r.map((function(e){return{id:e.id,name:e.name}}))})));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),o=function(){var t=Object(s.a)(a.a.mark((function t(n){var r;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.map((function(t){return e.query({query:A.AssessmentAddonGetSkillDocument,variables:{skillId:t}})})),t.abrupt("return",Promise.all(r).then((function(e){var t=[];return e.forEach((function(e){var n,r=null===(n=e.data)||void 0===n?void 0:n.skill;r&&t.push(Object(I.a)(Object(I.a)({},Object(A.getFormatedSkillBasicFragment)(r)),{},{libraryContext:Object(A.getFormatedLibraryBasicFragment)(r.libraryContext),qualifiers:r.qualifiers.nodes.map((function(e){return Object(A.getFormatedQualifierBasicFragment)(e)}))}))})),t})));case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),i=function(){var t=Object(s.a)(a.a.mark((function t(){return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.query({query:A.AssessmentAddonGetQualifiersDocument}).then((function(e){var t,n=null===(t=e.data)||void 0===t?void 0:t.qualifiers.nodes;if(n)return n.map((function(e){return Object(A.getFormatedQualifierBasicFragment)(e)}))})));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return{user_infos:{get:function(){var e=Object(s.a)(a.a.mark((function e(n){var r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n._key,e.abrupt("return",t(r));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},user_powers:{get:function(){var e=Object(s.a)(a.a.mark((function e(t){var r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t._key,e.abrupt("return",n(r));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},skill_validations:{get:function(){var e=Object(s.a)(a.a.mark((function e(t){var n,s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.reqParams.userId,s=t.reqParams.skillId,e.abrupt("return",r({userId:n,skillId:s}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},user_jobs:{get:function(){var e=Object(s.a)(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t._key,e.abrupt("return",u(n));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},skills:{get:function(){var e=Object(s.a)(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.keys,e.abrupt("return",o(n));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},app_qualifiers:{get:function(){var e=Object(s.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",i());case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},assessment:{get:function(){var e=Object(s.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},update_assessment:function(){var e=Object(s.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{success:!1});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}}}}]);