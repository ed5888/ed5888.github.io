(this["webpackJsonp@elamp/main-app"]=this["webpackJsonp@elamp/main-app"]||[]).push([[76],{1570:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return A}));var a=n(17),o=n(139),r=n.n(o),i=n(286),c=n(53),l=n(0),s=n.n(l),d=n(15),u=n(14),j=n(45),b=n(19),m=n(23),p=n(414),O=n(10),f=n(3),h=n(187),g=n(285),x=n(65),v=n(63),F=n(32),C=n(37),y=n(1147),D=n(766),S=n(1157),L=n(1156),T=n(1),P=["onSubmit","isOpened","onClose"],w={name:"",color:function(){var e=Math.floor(Math.random()*u.ColorPicker.colorPickerColors.length);return u.ColorPicker.colorPickerColors[e]}(),description:void 0,status:{status:F.ProjectStatus.ONGOING},customer:void 0,place:void 0,budget:void 0,externalId:void 0,startDate:void 0,endDate:void 0,groups:[],customFields:void 0},R=function(e){var t=e.onSubmit,n=e.isOpened,o=e.onClose,s=Object(g.a)(e,P),d=Object(x.h)(),j=Object(l.useState)(w),b=Object(c.a)(j,2),m=b[0],p=b[1],f=Object(l.useState)(!1),F=Object(c.a)(f,2),R=F[0],A=F[1],_=Object(u.useTranslate)({capitalize:!0}),I=Object(O.useAppContext)(),z=I.userGroups,M=I.customFields;Object(l.useEffect)((function(){z.length>0&&G({groups:z,isAllSelected:!1})}),[]),Object(l.useEffect)((function(){!0!==n&&N()}),[n]);var k=Object(l.useMemo)((function(){return 0===m.name.trim().length||"undefined"===typeof m.startDate||"undefined"===typeof m.endDate}),[m]),N=function(){p(w)},E=function(e){return function(t){p(Object(a.a)(Object(a.a)({},m),{},Object(h.a)({},e,t)))}},W=function(){var e=Object(i.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return A(!0),e.prev=1,e.next=4,t(m);case 4:N(),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),console.error("Error creating project",e.t0);case 10:A(!1);case 11:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(){return e.apply(this,arguments)}}(),G=function(e){var t=e.groups;e.isAllSelected;E("groups")(t)};return Object(T.jsxs)(O.FormContainerModal,Object(a.a)(Object(a.a)({title:_("new_staffing_project"),isOpened:n,onClose:o,onConfirm:W,onCancel:o,isDisabledSubmit:k,isLoading:R,maxHeight:"95vh"},s),{},{children:[Object(T.jsxs)(O.ContainerWithBottomSeparator,{children:[Object(T.jsx)(O.FormLine,{children:Object(T.jsx)(O.FormLabel,{content:_("project_name"),name:"projectName",required:!0,children:Object(T.jsx)(u.Input,{value:m.name,onChange:E("name"),width:"100%"})})}),Object(T.jsx)(O.FormLine,{children:Object(T.jsx)(O.FormLabel,{content:_("project_color"),name:"color",children:Object(T.jsx)(u.ColorPicker,{currentColor:m.color,onChangeColor:E("color")})})}),Object(T.jsx)(O.FormLine,{children:Object(T.jsx)(O.FormLabel,{content:_("description"),name:"description",children:Object(T.jsx)(u.TextArea,{value:m.description||"",onChange:E("description"),placeholder:"-"})})}),Object(T.jsx)(O.FormLine,{children:Object(T.jsx)(S.a,{value:m.status,onChange:E("status"),zIndex:d.zIndexes.MODAL_POPOVER})}),Object(T.jsx)(O.FormLine,{children:Object(T.jsx)(O.FormLabel,{content:_("client"),name:"client",children:Object(T.jsx)(u.Box,{width:"100%",children:Object(T.jsx)(L.a,{value:m.customer,onSubmit:function(e){var t=e.trim();p(Object(a.a)(Object(a.a)({},m),{},{customer:t.length>0?t:void 0}))},width:"100%",zIndex:d.zIndexes.MODAL_POPOVER})})})}),Object(T.jsx)(O.FormLine,{children:Object(T.jsx)(O.FormLabel,{content:_("location"),name:"location",children:Object(T.jsx)(v.SearchLocation,{onUpdateLocation:E("place"),width:"100%",zIndex:d.zIndexes.MODAL_POPOVER})})}),Object(T.jsx)(O.FormLine,{children:Object(T.jsx)(O.FormLabel,{content:_("budget"),name:"budget",children:Object(T.jsx)(y.a,{isCreation:!0,width:"100%",value:m.budget,onChange:E("budget")})})}),Object(T.jsx)(O.FormLine,{mb:"0px",children:Object(T.jsx)(O.FormLabel,{content:_("external_id"),name:"external_id",children:Object(T.jsx)(u.Input,{value:m.externalId,onChange:E("externalId"),width:"100%"})})})]}),Object(T.jsx)(O.ContainerWithBottomSeparator,{children:Object(T.jsx)(O.FormLine,{children:Object(T.jsx)(O.FormLabel,{content:_("entity"),name:"entity",children:Object(T.jsx)(v.GroupSelector,{initiallySelectedGroups:z,onSubmit:G,zIndex:d.zIndexes.MODAL_POPOVER})})})}),Object(T.jsx)(O.ContainerWithBottomSeparator,{isSeparator:!(M.projectFields.length>0),children:Object(T.jsx)(u.PeriodPicker,{startDate:m.startDate,isStartDateRequired:!0,isEndDateRequired:!0,endDate:m.endDate,onChange:function(e){var t,n=e.startDate,o=e.endDate;"string"===typeof o?t=o:"string"===typeof n&&(t=Object(C.localeMoment)(n).add(1,"day").toISOString()),p(Object(a.a)(Object(a.a)({},m),{},{startDate:n,endDate:t}))}})}),M.projectFields.length>0&&Object(T.jsx)(O.ContainerWithBottomSeparator,{isSeparator:!1,children:Object(T.jsx)(D.a,{customFieldsConfiguration:M.projectFields,value:m.customFields,onChange:E("customFields"),width:"100%"})})]}))},A=function(){var e,t=Object(u.useAlert)(),n=Object(O.useAppContext)(),o=n.getErrorMessage,h=n.userCapabilities,g=n.userGroups,x=n.userPreferences,v=n.customFields,F=Object(u.useSwitch)(),C=F.active,y=F.on,D=F.off,S=Object(d.useHistory)(),L=Object(u.useTranslate)(),P=s.a.useState(""),w=Object(c.a)(P,2),A=w[0],_=(w[1],Object(O.useFilters)({category:O.UserSavedDataFiltersEnum.ProjectListing,defaultSelectedFilterName:L("my_projects"),defaultEntity:"projectListing",defaultFilter:{projectListing:{managedBy:{inUsers:["me"]}}},entities:["projectListing"],initialStandardFilters:[{name:L("my_projects"),filters:{projectListing:{managedBy:{inUsers:["me"]}}}},{name:L("projects_of_my_groups"),filters:{projectListing:{groups:{inValues:g}}}}],mergeFilters:function(e){return e},savedDataFilters:null===x||void 0===x?void 0:x.savedDataFilters})),I=_.createAdvancedFilter,z=_.dataFilters,M=_.deleteAdvancedFilter,k=_.isDeletingAdvancedFilter,N=_.isOpenedDeleteConfirmModal,E=_.filterNameToDelete,W=_.localStorageLabel,G=_.onCloseDeleteConfirmModal,H=_.openDeleteAdvancedFilterModal,K=_.selectedFilter,B=_.setSelectedFilter,U=_.standardFilters,V=_.updateAdvancedFilter,q=Object(b.useGetProjectsQuery)({variables:{searchQuery:A,dataFilters:z.projectListing}}),J=q.data,Q=q.loading,Y=q.refetch;Object(l.useEffect)((function(){Object(p.setLocalStorage)({label:W,value:{dataFilters:z,selectedFilter:K,standardFilters:U}})}),[z,K,U]);var X=Object(b.useCreateProjectMutation)({onCompleted:function(e){Y().then((function(){var t,n;return S.push(f.b.STAFFING_PROJECTS.getRoute({projectId:null===e||void 0===e||null===(t=e.createProject)||void 0===t||null===(n=t.project)||void 0===n?void 0:n.id}))}))}}),Z=Object(c.a)(X,2),$=Z[0],ee=Z[1],te=(ee.loading,ee.data);Object(l.useEffect)((function(){Y()}),[te]);var ne=Object(l.useMemo)((function(){var e,t=null===J||void 0===J||null===(e=J.projects)||void 0===e?void 0:e.nodes;if(t)return t.map((function(e){var t,n,a,o=(null===(t=e.managers)||void 0===t?void 0:t.nodes.map((function(e){return{id:e.id,displayName:e.displayName,givenName:Object(b.maybeToOptional)(e.givenName),familyName:Object(b.maybeToOptional)(e.familyName),avatarURL:Object(b.maybeToOptional)(e.avatarURL)}})))||[],r=(null===e||void 0===e||null===(n=e.groups)||void 0===n?void 0:n.nodes.map((function(e){return{id:Object(b.maybeToOptional)(e.id),name:Object(b.maybeToOptional)(e.name),kind:"groupTag"}})))||[];return e.place&&(a={label:e.place.label}),{id:e.id,name:Object(b.maybeToOptional)(e.name),description:Object(b.maybeToOptional)(e.description),customer:Object(b.maybeToOptional)(e.customer),place:a,probability:Object(b.maybeToOptional)(e.probability),startDate:Object(b.maybeToOptional)(e.startDate),endDate:Object(b.maybeToOptional)(e.endDate),status:Object(b.maybeToOptional)(e.status),totalAssignedHeadCount:Object(b.maybeToOptional)(e.totalAssignedHeadCount)||0,totalHeadCount:Object(b.maybeToOptional)(e.totalHeadCount)||0,groups:r,managers:o}})).reverse()}),[J]),ae=function(){var e=Object(i.a)(r.a.mark((function e(n){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$({variables:{input:{name:n.name,color:n.color,customer:n.customer,description:n.description,status:n.status.status,probability:n.status.probability,startDate:n.startDate,endDate:n.endDate,budget:n.budget,groupsIds:n.groups,place:n.place,customFields:n.customFields,externalId:n.externalId}}}).then((function(){t.success(L("success")),D()})).catch((function(e){t.error(o(e))}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(T.jsxs)(O.PageLayout,{pr:"0px",pb:"0px",display:"flex",flexDirection:"column",overflowY:"auto",children:[Object(T.jsx)(O.TableToolbox,{totalCount:(null===ne||void 0===ne?void 0:ne.length)||0,isLoading:Q,quickFilters:[],advancedFilters:{advancedFilters:(null===x||void 0===x||null===(e=x.savedDataFilters)||void 0===e?void 0:e.projectListing)||[],advancedFiltersSchema:[Object(b.getDataFiltersSchemaWithCustomFields)(b.ProjectDataFiltersSchema,v.projectFields)],standardFiltersSchema:[b.ProjectDataFiltersSchema],standardFilters:U,selectedFilter:K,onSelectFilter:B,onNewFilter:function(e){I(Object(a.a)(Object(a.a)({},e),{},{filters:e.filters.project}))},onUpdateFilter:function(e){V(Object(a.a)(Object(a.a)({},e),{},{filters:e.filters.project}))},onDeleteFilter:function(e){H(e)}},menuActions:[],primaryAction:h.canCreateProject?{title:Object(m.maj)(L("create_staffing_project")),onClick:function(){y()}}:void 0}),Object(T.jsx)(u.Box,{height:"100%",width:"100%",children:Object(T.jsx)(O.TableContent,{rows:(null===ne||void 0===ne?void 0:ne.map((function(e){return e})))||[],columns:[{dataKey:"project",headerTitle:L("project",1),isSortable:!1,columnWidth:Object(j.b)("large"),cellRenderer:function(e){return Object(T.jsx)(O.LongTextCell,{text:e.node.name,size:"large",isTwoLines:!0,fontWeight:"bold",isClickable:!0,onClick:function(){return t=e.node.id,void S.push(f.b.STAFFING_PROJECTS.getRoute({projectId:t}));var t}})}},{dataKey:"customers",headerTitle:L("customers"),isSortable:!1,columnWidth:Object(j.b)("large"),cellRenderer:function(e){return Object(T.jsx)(O.LongTextCell,{text:e.node.customer,size:"large",isTwoLines:!0})}},{dataKey:"status",headerTitle:L("status"),isSortable:!1,columnWidth:Object(j.b)("medium"),cellRenderer:function(e){return Object(T.jsx)(O.ProjectStatusCell,{status:e.node.status,probability:e.node.probability})}},{dataKey:"startDate",headerTitle:L("startDate"),isSortable:!1,columnWidth:Object(j.b)("small"),cellRenderer:function(e){return Object(T.jsx)(O.DateCell,{date:e.node.startDate,size:"small"})}},{dataKey:"endDate",headerTitle:L("endDate"),isSortable:!1,columnWidth:Object(j.b)("small"),cellRenderer:function(e){return Object(T.jsx)(O.DateCell,{date:e.node.endDate,size:"small"})}},{dataKey:"location",headerTitle:L("location"),isSortable:!1,columnWidth:Object(j.b)("large"),cellRenderer:function(e){return Object(T.jsx)(O.LocationCell,{place:e.node.place,size:"large",isTwoLines:!0})}},{dataKey:"resource",headerTitle:L("staffing_resources_title"),isSortable:!1,columnWidth:Object(j.b)("small"),cellRenderer:function(e){return Object(T.jsx)(O.ProgressionStatusCell,{actualValue:e.node.totalAssignedHeadCount,attendedValue:e.node.totalHeadCount,size:"small"})}},{dataKey:"entity",headerTitle:L("entity"),isSortable:!1,columnWidth:Object(j.b)("large"),cellRenderer:function(e){return Object(T.jsx)(O.ObjectTagsCell,{size:"large",tags:e.node.groups})}},{dataKey:"managers",headerTitle:L("project_managers"),isSortable:!1,columnWidth:Object(j.b)("large"),cellRenderer:function(e){return Object(T.jsx)(O.MultipleUsersCell,{size:"large",users:e.node.managers})}}],isLoading:Q,noRowsRenderer:function(){return Object(T.jsx)(O.NoDataToDisplay,{title:L("no_projects")})},totalRowCount:(null===ne||void 0===ne?void 0:ne.length)||0,rowHeight:50,fixedColumnCount:1})}),Object(T.jsx)(R,{isOpened:C,onClose:D,onSubmit:ae}),Object(T.jsx)(O.DeleteAdvancedFilterConfirmModal,{filterName:E,isOpened:N,onConfirm:function(){M()},onCancel:G,isLoading:k})]})}}}]);