(this["webpackJsonp@elamp/main-app"]=this["webpackJsonp@elamp/main-app"]||[]).push([[69],{1557:function(e,t,n){"use strict";n.r(t);var s,a=n(748),r=n(139),o=n.n(r),i=n(286),u=n(53),c=n(0),d=n(15),l=n(88),m=n(1497),b=n(14),f=n(19),j=n(10),O=n(121),h=n(3),v=n(743),p=n(1),g=function(e){return Object(p.jsx)(b.SelectField,{name:e.schema.title,value:e.formData||[],onChange:function(t){e.onChange(t)},multiple:!0,source:e.schema.items.enum,readOnly:e.disabled})},y=function(e){var t=Object.assign({},e);return Object(p.jsxs)(b.Text,{as:"label",children:[Object(p.jsx)(b.Checkbox,{mr:0,checked:t.value,onChange:t.onChange,disabled:t.disabled}),t.label]})},x=function(e){var t=Object(c.useState)(e.formData),n=Object(u.a)(t,2),s=n[0],a=n[1],r=function(){e.onChange(s)};return function(e){return"date"===e.schema.format}(e)?Object(p.jsx)(b.DatePicker,{value:s,onChange:function(e){a(e.toISOString())},onBlur:r,readOnly:e.disabled}):function(e){return"textArea"===e.schema.format}(e)?Object(p.jsx)(b.TextArea,{value:s,onChange:a,onBlur:r,disabled:e.disabled}):function(e){return!0===e.schema.uniqueItems}(e)?Object(p.jsx)(b.SelectField,{name:e.name,value:s,onChange:a,source:e.schema.enum,readOnly:e.disabled}):Object(p.jsx)(b.Input,{value:s,onChange:a,onBlur:r,readOnly:e.disabled})},S=function(e){return e.schema.properties||"boolean"===e.schema.type?Object(p.jsx)(b.Box,{mb:0,children:e.children}):Object(p.jsx)(b.Label,{content:e.label,name:e.id,mb:0,children:e.children})},C=n(285),F=["title"],A=function(e){var t=e.title;Object(C.a)(e,F);return Object(p.jsx)(b.Text,{fontWeight:"bold",fontSize:"big",mb:1,children:t})};t.default=function(){var e=Object(j.useAppContext)().getErrorMessage,t=Object(c.useState)(),n=Object(u.a)(t,2),r=n[0],C=n[1],F=Object(d.useParams)(),E=F.assessmentId,w=F.assessmentRowId,I=Object(b.useTranslate)(),N=Object(d.useHistory)(),T=Object(v.a)().redirectToEntity404,k=Object(b.useAlert)(),R=Object(f.useGetAssessmentJsonContentQuery)({variables:{assessmentId:E},onError:function(e){return T({entity:O.d.Assessment,error:e})}}),D=R.data,J=R.loading,M=Object(f.useSaveAssessmentRowMutation)(),_=Object(u.a)(M,2),B=_[0],P=_[1].loading,U=Object(c.useMemo)((function(){var e,t,n;if("AssessmentFormContentJSONForm"===(null===D||void 0===D||null===(e=D.assessment)||void 0===e||null===(t=e.assessmentForm)||void 0===t||null===(n=t.content)||void 0===n?void 0:n.__typename)){var s=D.assessment.assessmentForm.content.json;return"string"===typeof s?JSON.parse(s):void 0}}),[D]),G=Object(c.useMemo)((function(){var e;return"undefined"===typeof(null===D||void 0===D||null===(e=D.assessment)||void 0===e?void 0:e.status)||D.assessment.status===f.AssessmentStatus.Closed||D.assessment.status===f.AssessmentStatus.Validating}),[D]),L=Object(c.useMemo)((function(){var e;if(null===D||void 0===D||null===(e=D.assessment)||void 0===e?void 0:e.evaluatedUser)return D.assessment.evaluatedUser.id}),[D]);Object(c.useEffect)((function(){var e,t,n;(null===D||void 0===D||null===(e=D.assessment)||void 0===e?void 0:e.assessmentRows)&&("undefined"!==typeof w&&(n=D.assessment.assessmentRows.find((function(e){return e.id===w}))),"undefined"!==typeof(null===(t=n)||void 0===t?void 0:t.content)?C(n.content):C({}))}),[D]);var H=function(){var t=Object(i.a)(o.a.mark((function t(n){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!G){t.next=2;break}return t.abrupt("return");case 2:return t.abrupt("return",B({variables:{input:{assessmentId:E,id:w,content:JSON.stringify(n)}}}).catch((function(t){k.error(e(t))})));case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return J||"undefined"===typeof r?Object(p.jsx)(b.Loader,{}):"undefined"===typeof U?Object(p.jsx)(p.Fragment,{children:"No JSON Schema."}):Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)(l.Global,{styles:Object(l.css)(s||(s=Object(a.a)(["\n          .formStyle {\n            width: 100%;\n          }\n          fieldset {\n            border: none;\n          }\n        "])))}),Object(p.jsx)(b.Column,{width:"100%",height:"100%",p:1,children:Object(p.jsx)(m.a,{schema:U,fields:{StringField:x,TitleField:A,ArrayField:g},FieldTemplate:S,widgets:{CheckboxWidget:y},formData:r,onChange:function(e){C(e.formData),H(e.formData)},className:"formStyle",onSubmit:function(){P||H(r).then((function(){"undefined"!==typeof L&&N.push(h.b.USER_PROFILE_ASSESSMENT.getRoute({userId:L,assessmentId:E}))}))},disabled:G,children:Object(p.jsx)(b.Button,{type:"submit",children:I(G?"back":"submit")})})})]})}},743:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var s=n(15),a=n(19),r=n(3),o=function(){var e=Object(s.useHistory)();return{redirectToEntity404:function(t){var n=t.entity;t.error.message===a.ErrorCodeEnum.NotFound&&e.push(r.b.PAGE_NOT_FOUND.getRoute({entity:n}))}}}}}]);