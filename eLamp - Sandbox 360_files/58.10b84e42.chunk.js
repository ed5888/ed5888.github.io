(this["webpackJsonp@elamp/main-app"]=this["webpackJsonp@elamp/main-app"]||[]).push([[58],{1530:function(e,t,n){"use strict";n.r(t),n.d(t,"ALLOCATION_STATUS_MAP",(function(){return A}));var s,a=n(139),r=n.n(a),i=n(286),o=n(53),l=n(188),c=n(17),d=n(187),u=n(0),m=n(65),p=n(37),j=n(14),f=n(19),b=n(414),g=n(32),O=n(45),v=n(295),y=n(820),C=n(10),h=n(785),x=n(1),S=(s={},Object(d.a)(s,g.ProjectAssignmentStatus.Confirmed,g.ProjectAssignmentStatus.Confirmed),Object(d.a)(s,g.ProjectAssignmentStatus.Provisional,g.ProjectAssignmentStatus.Provisional),Object(d.a)(s,g.ProjectAssignmentStatus.Simulated,g.ProjectAssignmentStatus.Simulated),s),A=new Map([[g.ProjectAssignmentStatus.Completed,{labelKey:g.ProjectAssignmentStatus.Completed.toLocaleLowerCase(),color:"success.0"}],[g.ProjectAssignmentStatus.Confirmed,{labelKey:g.ProjectAssignmentStatus.Confirmed.toLocaleLowerCase(),color:"secondary.0"}],[g.ProjectAssignmentStatus.Planned,{labelKey:g.ProjectAssignmentStatus.Planned.toLocaleLowerCase(),color:"primary.0"}],[g.ProjectAssignmentStatus.Provisional,{labelKey:g.ProjectAssignmentStatus.Provisional.toLocaleLowerCase(),color:"alert.0"}],[g.ProjectAssignmentStatus.Simulated,{labelKey:g.ProjectAssignmentStatus.Simulated.toLocaleLowerCase(),color:"grey.1"}]]),F={isBulkDeleteConfirmationModalOpened:!1,isStatusUpdateConfirmationModalOpened:!1,isProjectAssignmentOpened:!1,updatedStatus:void 0},_=function(e,t){switch(t.type){case"closeStatusUpdateConfirmationModal":return Object(c.a)(Object(c.a)({},e),{},{isStatusUpdateConfirmationModalOpened:!1,updatedStatus:void 0});case"reset":return F;case"toggleIsBulkDeleteConfirmationModalOpened":return Object(c.a)(Object(c.a)({},e),{},{isBulkDeleteConfirmationModalOpened:!e.isBulkDeleteConfirmationModalOpened});case"setUpdatedStatus":return Object(c.a)(Object(c.a)({},e),{},{isStatusUpdateConfirmationModalOpened:"undefined"!==typeof t.updatedStatus,updatedStatus:t.updatedStatus});case"toggleIsProjectAssignmentOpened":return Object(c.a)(Object(c.a)({},e),{},{isProjectAssignmentOpened:!e.isProjectAssignmentOpened});default:return F}},D=function(e){return e.map((function(e){return{id:e.id,capabilities:{canUpdate:e.capabilities.canUpdate,canDelete:e.capabilities.canDelete,allowedStatuses:e.capabilities.allowedStatuses},status:e.status,startDate:e.startDate,endDate:e.endDate,updatedAt:Object(f.maybeToOptional)(e.updatedAt),createdAt:e.createdAt,rate:e.rate,customFields:e.customFields,project:{id:e.project.id,name:e.project.name},projectNeed:{id:e.projectNeed.id,name:e.projectNeed.name},assignedUser:Object(f.getFormatedUserBasicFragment)(e.assignedUser)}}))},L=function(e,t){var n;if("undefined"!==typeof(null===e||void 0===e?void 0:e.inValues)||"undefined"!==typeof t)return{inValues:Array.from(new Set((n=(null===e||void 0===e?void 0:e.inValues)||[]).concat.apply(n,Object(l.a)(t||[])))),notInValues:null===e||void 0===e?void 0:e.notInValues}},P=function(e,t){return[{name:e("assignments_of_my_subalterns"),filters:{projectAssignmentList:{user:{managedBy:["me"]}}}},{name:e("assignments_of_all_my_subalterns"),filters:{projectAssignmentList:{user:{managedByWithHierarchy:["me"]}}}},{name:e("assignments_of_my_entities"),filters:{projectAssignmentList:{user:{inGroups:t}}}},{name:e("assigments_of_my_projects"),filters:{projectAssignmentList:{project:{managedBy:["me"]}}}},{name:e("assignments_of_my_entities_projects"),filters:{projectAssignmentList:{project:{inGroups:t}}}}]};t.default=function(){var e,t,n,s=Object(j.useTranslate)({capitalize:!0}),a=Object(m.h)(),d=Object(j.useAlert)(),M=Object(C.useAppContext)(),w=M.customFields,k=M.getErrorMessage,I=M.userGroups,T=M.usersManagedByMe,R=M.userPreferences,N=Object(u.useReducer)(_,F),U=Object(o.a)(N,2),B=U[0],E=B.isBulkDeleteConfirmationModalOpened,z=B.isProjectAssignmentOpened,K=B.isStatusUpdateConfirmationModalOpened,W=B.updatedStatus,V=U[1],G=Object(C.useCheckbox)(),Y=G.handleCheckbox,q=G.isActionModeToolboxActive,Q=G.resetCheckboxState,H=G.selectedIds,Z=G.setSelectedIds,J=Object(u.useMemo)((function(){return Object(O.c)(w.projectAssignmentFields)}),[w]),X=Object(u.useMemo)((function(){if("undefined"!==typeof W&&"undefined"!==typeof H)return H.map((function(e){return{id:e,status:W}}))}),[H,W]),$=Object(C.useFilters)({category:C.UserSavedDataFiltersEnum.ProjectAssignmentList,defaultEntity:"projectAssignmentList",defaultFilter:{projectAssignmentList:{user:T.length>0?{managedBy:["me"]}:{inGroups:I}}},defaultSelectedFilterName:T.length>0?s("assignments_of_my_subalterns"):s("assignments_of_my_entities"),entities:["projectAssignmentList"],initialStandardFilters:P(s,I),mergeFilters:function(e,t){var n,s,a;return Object(c.a)(Object(c.a)({},e),{},{projectAssignmentList:Object(c.a)(Object(c.a)({},e.projectAssignmentList),{},{status:L(null===(n=e.projectAssignmentList)||void 0===n?void 0:n.status,null===(s=t.projectAssignmentList)||void 0===s||null===(a=s.status)||void 0===a?void 0:a.inValues)})})},savedDataFilters:null===R||void 0===R?void 0:R.savedDataFilters}),ee=$.createAdvancedFilter,te=$.dataFilters,ne=$.deleteAdvancedFilter,se=$.filterNameToDelete,ae=$.isDeletingAdvancedFilter,re=$.isOpenedDeleteConfirmModal,ie=$.localStorageLabel,oe=$.quickFilters,le=$.onCloseDeleteConfirmModal,ce=$.openDeleteAdvancedFilterModal,de=$.selectedFilter,ue=$.setQuickFilters,me=$.setSelectedFilter,pe=$.standardFilters,je=$.updateAdvancedFilter;Object(u.useEffect)((function(){Object(b.setLocalStorage)({label:ie,value:{dataFilters:te,quickFilters:oe,selectedFilter:de,standardFilters:pe}})}),[te,oe,de,pe]);var fe=Object(f.usePaginateGraphQLQuery)({query:f.GetAllProjectAssignmentsDocument,variables:{dataFilters:te.projectAssignmentList},pageSize:100,getConnections:function(e){return e.projectAssignments}}),be=fe.nodes,ge=fe.loading,Oe=fe.isLoadingMore,ve=fe.totalCount,ye=fe.loadMore,Ce=fe.fetchMorePromise,he=fe.isRefetching,xe=fe.refetch,Se=Object(f.useProjetAssignmentBulkUpdateMutation)(),Ae=Object(o.a)(Se,2),Fe=Ae[0],_e=Ae[1].loading,De=Object(f.useProjetAssignmentBulkDeleteMutation)(),Le=Object(o.a)(De,2),Pe=Le[0],Me=Le[1].loading,we=Object(h.b)({}),ke=we.isOpened,Ie=we.close,Te=we.projectAssignmentId,Re=we.projectNeedId,Ne=we.setProjectAssignmentId,Ue=Object(u.useMemo)((function(){return D(be)}),[be]),Be=Object(u.useMemo)((function(){var e,t;return((null===(e=oe.projectAssignmentList)||void 0===e||null===(t=e.status)||void 0===t?void 0:t.inValues)||[]).length>0}),[oe]),Ee=function(){var e=[];return e.push({dataKey:"checkBoxes",headerTitle:"".concat(s("assignment_selection")),isSortable:!1,isIcon:!0,iconData:{icon:v.a,size:20},columnWidth:Object(O.b)("xtraSmall"),cellRenderer:function(e){var t=e.node;return Object(x.jsx)(C.CheckboxCell,{size:"xtraSmall",value:t.id,isChecked:(null===H||void 0===H?void 0:H.includes(t.id))||!1,onChange:Y})}},{dataKey:"openProjectPanel",headerTitle:"".concat(s("assignment_edit")),isSortable:!1,isIcon:!0,iconData:{icon:y.a,size:20},columnWidth:Object(O.b)("xtraSmall"),cellRenderer:function(e){var t=e.node;return Object(x.jsx)(C.IconAloneCell,{size:"xtraSmall",icon:Object(x.jsx)(j.Box,{onClick:function(){Ne(t.id)},children:Object(x.jsx)(j.Icon,{as:y.a,size:20,color:a.colors.grey[6]})})})}},{dataKey:"familyName",headerTitle:s("collaborators"),isSortable:!1,columnWidth:Object(O.b)("large"),cellRenderer:function(e){var t=e.node;return Object(x.jsx)(C.SingleUserCell,{user:t.assignedUser,size:"large"})},xlsCellRenderer:function(e){return e.node.assignedUser.displayName}},{dataKey:"project.name",headerTitle:s("project",1),isSortable:!1,columnWidth:Object(O.b)("large"),cellRenderer:function(e){var t=e.node;return Object(x.jsx)(C.ShortTextCell,{text:t.project.name,size:"large"})},xlsCellRenderer:function(e){return e.node.project.name||""}},{dataKey:"projectNeed.name",headerTitle:s("staffing_project_need_title",1),isSortable:!1,columnWidth:Object(O.b)("large"),cellRenderer:function(e){var t=e.node;return Object(x.jsx)(C.ShortTextCell,{text:t.projectNeed.name,size:"large"})},xlsCellRenderer:function(e){return e.node.projectNeed.name}},{dataKey:"status",headerTitle:s("status"),isSortable:!1,columnWidth:Object(O.b)("medium"),cellRenderer:function(e){var t=e.node;return Object(x.jsx)(C.GenericStatusCell,{statusObject:Object(O.g)(A,t.status),size:"medium"},t.status)},xlsCellRenderer:function(e){var t=e.node;return Object(C.xlsEnumCell)(t.status,function(e){var t=e.translate,n=new Map;return A.forEach((function(e,s){n.set(s,t(e.labelKey))})),n}({translate:s}))}},{dataKey:"startDate",headerTitle:s("startDate"),isSortable:!1,columnWidth:Object(O.b)("small"),cellRenderer:function(e){var t=e.node;return Object(x.jsx)(C.DateCell,{date:t.startDate,size:"small"})},xlsCellRenderer:function(e){var t=e.node;return Object(C.xlsDateCell)(t.startDate)}},{dataKey:"endDate",headerTitle:s("endDate"),isSortable:!1,columnWidth:Object(O.b)("small"),cellRenderer:function(e){var t=e.node;return Object(x.jsx)(C.DateCell,{date:t.endDate,size:"small"})},xlsCellRenderer:function(e){var t=e.node;return Object(C.xlsDateCell)(t.endDate)}},{dataKey:"rate",headerTitle:s("rate"),isSortable:!1,columnWidth:Object(O.b)("xtraSmall"),cellRenderer:function(e){var t=e.node;return Object(x.jsx)(C.TotalPercentageCell,{value:{rate:t.rate},size:"xtraSmall"})},xlsCellRenderer:function(e){var t=e.node;return Object(C.xlsNumberCell)(t.rate)}}),J.size>0&&J.forEach((function(t){e.push({dataKey:"customFields.".concat(t._key),headerTitle:t.name,isSortable:!1,columnWidth:Object(O.b)("large"),cellRenderer:function(e){var n=e.node;return"undefined"!==typeof n.customFields&&Object.keys(n.customFields||{}).includes(t._key)?Object(x.jsx)(C.CustomFieldCell,{field:t,customFields:n.customFields,value:n.customFields[t._key],size:"large"}):Object(x.jsx)(j.Line,{width:"100%",height:"100%",bg:"grey.0"})},xlsCellRenderer:function(e){var n=e.node;return Object(C.xlsCustomFieldCell)({field:t,value:t._key in(n.customFields||{})?(n.customFields||{})[t._key]:null,translate:s})}})})),e.push({dataKey:"updatedAt",headerTitle:s("last_update",{smart_count:1}),isSortable:!1,columnWidth:Object(O.b)("small"),cellRenderer:function(e){var t=e.node;return Object(x.jsx)(C.UpdatedAtCell,{updatedAt:t.updatedAt,size:"small"})},xlsCellRenderer:function(e){var t=e.node;return"".concat(Object(p.localeMoment)(t.updatedAt).format("DD/MM/YYYY"))}},{dataKey:"createdAt",headerTitle:s("creation_date"),isSortable:!1,columnWidth:Object(O.b)("small"),cellRenderer:function(e){var t=e.node;return Object(x.jsx)(C.DateCell,{date:t.createdAt,size:"small"})},xlsCellRenderer:function(e){var t=e.node;return"".concat(Object(p.localeMoment)(t.createdAt).format("DD/MM/YYYY"))}}),e},ze=function(){V({type:"toggleIsProjectAssignmentOpened"})},Ke=function(e){ue({projectAssignmentList:Object(c.a)(Object(c.a)({},oe.projectAssignmentList),{},{status:{inValues:e.length>0?e:void 0}})})},We=function(){var e=Object(i.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:xe();case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ve=Object(C.useExportTable)({worksheetName:"Assignment_management_".concat(Object(p.localeMoment)().format("DD.MM.YYYY")),columns:Ee().slice(2),fetchRowsPromise:Ce,rowsMappingFn:function(e){return D(e.projectAssignments.nodes)},pageSize:100,totalRowCount:ve,fixedColumnCount:1}),Ge=Object(o.a)(Ve,2),Ye=Ge[0],qe=Ge[1];return Object(x.jsxs)(C.PageLayout,{pb:"0px",pr:"0px",display:"flex",flexDirection:"column",children:[Object(x.jsx)(C.TableToolbox,{totalCount:ve,isLoading:ge,advancedFilters:{advancedFilters:(null===R||void 0===R||null===(e=R.savedDataFilters)||void 0===e?void 0:e.projectAssignmentList)||[],advancedFiltersSchema:[Object(f.getDataFiltersSchemaWithCustomFields)(f.ProjectAssignmentDataFiltersSchema,w.projectAssignmentFields)],subFieldsCustomFieldsSchema:{user:Object(f.getDataFiltersCustomFields)(w.userFields)||[],project:[{field:"status",category:"",dataField:"status",type:f.DataFiltersConditionValueFieldSpecType.ENUM,spec:{values:[{key:"completed",value:g.ProjectStatus.PAST},{key:"confirmed",value:g.ProjectStatus.ONGOING},{key:"upcoming",value:g.ProjectStatus.UPCOMING}]},comparators:[{comparatorId:f.DataFiltersConditionEnumComparators.IN_VALUES},{comparatorId:f.DataFiltersConditionEnumComparators.NOT_IN_VALUES}]}].concat(Object(l.a)(Object(f.getDataFiltersCustomFields)(w.projectFields)||[])),projectNeed:Object(f.getDataFiltersCustomFields)(w.projectNeedFields)||[]},standardFilters:pe,selectedFilter:de,onNewFilter:function(e){ee(Object(c.a)(Object(c.a)({},e),{},{filters:e.filters[f.ProjectAssignmentDataFiltersSchema.entity]}))},onUpdateFilter:function(e){je(e)},onDeleteFilter:function(e){ce(e)},onSelectFilter:me},quickFilters:[{id:"status",title:s("status"),type:C.QuickFilterTypes.MultiSelect,isOpened:z,elements:S,value:(null===(t=te.projectAssignmentList)||void 0===t||null===(n=t.status)||void 0===n?void 0:n.inValues)||[],onOpen:ze,onClose:ze,isSelected:Be,onApplyFilter:Ke,onClearFilter:function(){Ke([])}}],menuActions:[{title:s("export"),onClick:function(){return qe()},disabled:Ye}],actionModeProps:{isActive:q,onClose:function(){Z(void 0)},onDeleteSelection:function(){V({type:"toggleIsBulkDeleteConfirmationModalOpened"})},quickFilters:[{id:"assignment_status_update",title:s("assignment_status_update"),type:C.QuickFilterTypes.SingleSelect,elements:S,value:W,isResetOption:!1,isSelected:"string"===typeof W,onApplyFilter:function(e){V({type:"setUpdatedStatus",updatedStatus:e,selectedIds:H})},onClearFilter:function(){V({type:"setUpdatedStatus",updatedStatus:void 0,selectedIds:H})}}]}}),he&&Object(x.jsx)(j.LoadingOverlay,{}),Object(x.jsx)(C.TableContent,{rows:Ue,fixedColumnCount:3,selectedIdsForSelectedLines:H,columns:Ee(),isLoading:ge,isLoadingMore:Oe,loadMoreRows:function(e){var t=e.startIndex;ye(t)},noRowsRenderer:function(){return Object(x.jsx)(C.NoDataToDisplay,{})},totalRowCount:ve}),Object(x.jsx)(h.a,{isOpened:ke,onClose:Ie,projectNeedId:Re,projectAssignmentId:Te,onDeletedProjectNeed:function(){},onDeletedProjectAssignment:function(){xe(),Ie()},onChangeProjectAssignmentId:Ne,onUpdatedProjectAssignment:We},"".concat(Re,"_").concat(Te)),Object(x.jsx)(C.DeleteAdvancedFilterConfirmModal,{filterName:se,isOpened:re,onConfirm:function(){ne()},onCancel:le,isLoading:ae}),Object(x.jsx)(j.ConfirmModal,{isOpened:K||E,onConfirm:K?function(){"undefined"!==typeof X&&Fe({variables:{input:{assignments:X}},onCompleted:function(){d.success(s("success")),V({type:"reset"}),Q(),xe()},onError:function(e){return d.error(k(e))}})}:function(){"undefined"!==typeof H&&H.length>0&&Pe({variables:{input:{ids:H}},onCompleted:function(){d.success(s("success")),V({type:"reset"}),xe()},onError:function(e){return d.error(k(e))}})},onCancel:function(){return V({type:K?"closeStatusUpdateConfirmationModal":"toggleIsBulkDeleteConfirmationModalOpened"})},isLoading:_e||Me,children:Object(x.jsxs)(j.Box,{display:"flex",flexDirection:"column",children:[Object(x.jsx)(j.Text,{fontSize:"big",fontWeight:"bold",pb:3,children:s(K?"project_assignments_bulk_status_update_confirmation_title":"project_assignments_bulk_deletion_confirmation_title")}),Object(x.jsx)(j.Text,{pb:3,children:s(K?"project_assignments_bulk_status_update_confirmation_info":"project_assignments_bulk_deletion_confirmation_info")}),"undefined"!==typeof W&&K&&Object(x.jsx)(j.Box,{height:"50px",children:Object(x.jsx)(C.GenericStatusCell,{statusObject:Object(O.g)(A,W),size:"medium"},W)})]})})]})}},795:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var s,a=n(0),r=["title","titleId"];function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e}).apply(this,arguments)}function o(e,t){if(null==e)return{};var n,s,a=function(e,t){if(null==e)return{};var n,s,a={},r=Object.keys(e);for(s=0;s<r.length;s++)n=r[s],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(s=0;s<r.length;s++)n=r[s],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function l(e,t){var n=e.title,l=e.titleId,c=o(e,r);return a.createElement("svg",i({viewBox:"0 0 10 16",xmlns:"http://www.w3.org/2000/svg",ref:t,"aria-labelledby":l},c),n?a.createElement("title",{id:l},n):null,s||(s=a.createElement("path",{d:"M2.16667 0L0 2.27368L5.66667 8L0 13.7263L2.16667 16L10 8L2.16667 0Z"})))}var c=a.forwardRef(l);n.p},799:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));n(0);var s=n(14),a=n(1),r=function(e){var t=e.renderHeader,n=e.children;return Object(a.jsxs)(s.Box,{width:"100%",height:"100%",bg:"white",display:"flex",flexDirection:"column",backgroundColor:"white",children:[Object(a.jsx)(s.Box,{flexGrow:0,p:2,children:t()}),Object(a.jsx)(s.Box,{px:2,children:Object(a.jsx)(s.Separator,{width:"100%"})}),Object(a.jsx)(s.Box,{flexGrow:1,overflow:"auto",p:2,width:"100%",children:n})]})}},820:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var s,a=n(0),r=["title","titleId"];function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e}).apply(this,arguments)}function o(e,t){if(null==e)return{};var n,s,a=function(e,t){if(null==e)return{};var n,s,a={},r=Object.keys(e);for(s=0;s<r.length;s++)n=r[s],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(s=0;s<r.length;s++)n=r[s],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function l(e,t){var n=e.title,l=e.titleId,c=o(e,r);return a.createElement("svg",i({viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",ref:t,"aria-labelledby":l},c),n?a.createElement("title",{id:l},n):null,s||(s=a.createElement("path",{d:"M2.96979 17.0274H4.34865L12.8434 8.52055L11.4645 7.13973L2.96979 15.6466V17.0274ZM17.0538 7.09041L12.868 2.94795L14.2469 1.56712C14.6244 1.18904 15.0883 1 15.6385 1C16.1881 1 16.6516 1.18904 17.0292 1.56712L18.408 2.94795C18.7856 3.32603 18.9826 3.78236 18.999 4.31693C19.0154 4.85085 18.8348 5.30685 18.4573 5.68493L17.0538 7.09041ZM15.6257 8.54521L5.18581 19H1V14.8082L11.4399 4.35342L15.6257 8.54521Z"})))}var c=a.forwardRef(l);n.p}}]);